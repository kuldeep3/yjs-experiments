!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("valtio/vanilla"),require("yjs"),require("fast-deep-equal")):"function"==typeof define&&define.amd?define(["exports","valtio/vanilla","yjs","fast-deep-equal"],t):t((e||self).valtioYjs={},e.vanilla,e.yjs,e.fastDeepEqual)}(this,function(e,t,n,r){function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function o(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,t}var a=/*#__PURE__*/o(n),f=/*#__PURE__*/i(r),s=function(e){return"object"==typeof e&&null!==e&&void 0!==t.getVersion(e)},l=function(e){return Array.isArray(e)&&void 0!==t.getVersion(e)},u=function(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e},c=function(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e},d=function(e,t,n){e?e.transact(n,t.transactionOrigin):n()},p=function e(n,r,i){void 0===i&&(i={});var o=new WeakMap,c=function(t,n){d(r.doc,i,function(){if(!s(t)||!o.has(t)||o.get(t)!==r.get(n))if(l(t)){var f=new a.Array;o.set(t,f),v(t,f,i),r.set(n,f)}else if(s(t)){var c=new a.Map;o.set(t,c),e(t,c,i),r.set(n,c)}else u(t)?r.set(n,t):"production"!==process.env.NODE_ENV&&console.warn("unsupported p type",t)})},p=function(r,f){var l=n[f];if(!s(l)||o.get(l)!==r)if(r instanceof a.Array){var c=t.proxy([]);o.set(c,r),v(c,r,i),n[f]=c}else if(r instanceof a.Map){var d=t.proxy(r.toJSON());o.set(d,r),e(d,r,i),n[f]=d}else u(r)?n[f]=r:"production"!==process.env.NODE_ENV&&console.warn("unsupported y type",r)};Object.entries(n).forEach(function(t){var n=t[0],u=t[1],d=r.get(n);l(u)&&d instanceof a.Array&&f.default(u,d.toJSON())?(o.set(u,d),v(u,d,i)):!Array.isArray(u)&&s(u)&&d instanceof a.Map&&f.default(u,d.toJSON())?(o.set(u,d),e(u,d,i)):c(u,n)}),r.forEach(function(t,r){var u=n[r];l(u)&&t instanceof a.Array&&f.default(u,t.toJSON())?(o.set(u,t),v(u,t,i)):!Array.isArray(u)&&s(u)&&t instanceof a.Map&&f.default(u,t.toJSON())?(o.set(u,t),e(u,t,i)):p(t,r)}),t.subscribe(n,function(e){e.forEach(function(e){var t=e[1];if(1===t.length){var i=t[0];if("delete"===e[0])r.delete(i);else if("set"===e[0]){var o=n[i],s=r.get(i);f.default(s instanceof a.AbstractType?s.toJSON():s,o)||c(o,i)}}})}),r.observe(function(e){e.keysChanged.forEach(function(e){var t=r.get(e);void 0===t?delete n[e]:p(t,e)})})},v=function e(n,r,i){void 0===i&&(i={});var o=new WeakMap,u=function(t,n){if(l(t)){var f=new a.Array;o.set(t,f),e(t,f,i),r.insert(n,[f])}else if(s(t)){var u=new a.Map;o.set(t,u),p(t,u,i),r.insert(n,[u])}else{if(!c(t))throw new Error("unsupported p type");r.insert(n,[t])}},v=function(r,f){if(r instanceof a.Array){var s=t.proxy([]);o.set(s,r),e(s,r,i),n.splice(f,0,s)}else if(r instanceof a.Map){var l=t.proxy(r.toJSON());o.set(l,r),p(l,r),n.splice(f,0,l)}else{if(!c(r))throw new Error("unsupported y type");n.splice(f,0,r)}};n.forEach(function(t,n){var d=r.get(n);l(t)&&d instanceof a.Array&&f.default(t,d.toJSON())?o.get(t)!==d&&(o.set(t,d),e(t,d,i)):!Array.isArray(t)&&s(t)&&d instanceof a.Map&&f.default(t,d.toJSON())?o.get(t)!==d&&(o.set(t,d),p(t,d,i)):c(t)&&c(d)&&t===d||u(t,n)}),r.forEach(function(t,r){var u=n[r];l(u)&&t instanceof a.Array&&f.default(u,t.toJSON())?o.get(u)!==t&&(o.set(u,t),e(u,t,i)):!Array.isArray(u)&&s(u)&&t instanceof a.Map&&f.default(u,t.toJSON())?o.get(u)!==t&&(o.set(u,t),p(u,t,i)):c(u)&&c(t)&&u===t||v(t,r)}),n.splice(r.length),t.subscribe(n,function(e){var t=function(e){for(var t=e.flatMap(function(e){if("resolve"===e[0]||"reject"===e[0])return[];if(1!==e[1].length)return[];var t=Number(e[1][0]);return Number.isFinite(t)?[[e[0],t,e[2],e[3]]]:[]}),n=function(e,n){for(var r=0,i=null;e+r+1<t.length;){if(("set"===t[e+r+1][0]||"insert"===t[e+r+1][0])&&t[e+r+1][1]<n&&t[e+r+1][3]===t[e][2])return r+1;if(null!==i||"set"!==t[e+r+1][0]&&"insert"!==t[e+r+1][0]||t[e+r+1][1]!==n-(r+1)||void 0!==t[e+r+1][3])if(null===i&&e+r+1<t.length&&"set"===t[e+r+1][0]&&void 0!==t[e+r+1][3])i=[e+r+1,t[e+r+1][1]],r+=1;else{if(null===i||"set"!==t[e+r+1][0]||t[e+r+1][1]!==i[1]+(r+1-i[0])||void 0===t[e+r+1][3])return null;r+=1}else r+=1}return null},r=function(e,n){for(var r=0;e+r+1<t.length&&"delete"===t[e+r+1][0]&&t[e+r+1][1]===n-(r+1);)r+=1;return r},i=0;i<t.length;)if("set"!==t[i][0]&&"insert"!==t[i][0]||void 0!==t[i][3])if(i>0&&"delete"===t[i][0]){var o=t[i][1],a=r(i,o);if("set"===t[i-1][0]&&t[i-1][1]===o-(a+1)&&t[i-1][2]===t[i][2]){var f=["delete",o-(a+1),t[i-1][3],void 0];t.splice(i-1,2),t.splice(i-1+a,0,f),i-=1}else i+=1}else i+=1;else{var s=n(i,t[i][1]);null!==s?(t.splice(i+s,1,["insert",t[i+s][1],t[i+s][2],void 0]),t.splice(i,1)):i+=1}return t}(e);f.default(r.toJSON(),n)||d(r.doc,i,function(){t.forEach(function(e){var t=e[1];if("delete"!==e[0]){var i=n[t];void 0!==i&&("set"===e[0]?(r.length>t&&r.delete(t,1),u(i,t)):"insert"===e[0]&&u(i,t))}else r.length>t&&r.delete(t,1)})})}),r.observe(function(e){if(!f.default(n,r.toJSON())){var t=0;e.changes.delta.forEach(function(e){e.retain&&(t+=e.retain),e.delete&&n.splice(t,e.delete),e.insert&&(Array.isArray(e.insert)?e.insert.forEach(function(e,n){v(e,t+n)}):v(e.insert,t),t+=e.insert.length)})}})};e.bindProxyAndYArray=v,e.bindProxyAndYMap=p});
//# sourceMappingURL=index.umd.js.map
