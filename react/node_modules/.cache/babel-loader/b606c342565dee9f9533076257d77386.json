{"ast":null,"code":"import { getVersion as e, subscribe as t, proxy as s } from \"valtio/vanilla\";\nimport * as n from \"yjs\";\nimport r from \"fast-deep-equal\";\n\nconst o = t => \"object\" == typeof t && null !== t && void 0 !== e(t),\n      i = t => Array.isArray(t) && void 0 !== e(t),\n      a = e => null === e || \"string\" == typeof e || \"number\" == typeof e || \"boolean\" == typeof e,\n      l = e => \"string\" == typeof e || \"number\" == typeof e || \"boolean\" == typeof e,\n      c = (e, t, s) => {\n  e ? e.transact(s, t.transactionOrigin) : s();\n},\n      f = function (e, l) {\n  let y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  const u = new WeakMap(),\n        d = (e, t) => {\n    c(l.doc, y, () => {\n      if (!o(e) || !u.has(e) || u.get(e) !== l.get(t)) if (i(e)) {\n        const s = new n.Array();\n        u.set(e, s), p(e, s, y), l.set(t, s);\n      } else if (o(e)) {\n        const s = new n.Map();\n        u.set(e, s), f(e, s, y), l.set(t, s);\n      } else a(e) ? l.set(t, e) : \"production\" !== process.env.NODE_ENV && console.warn(\"unsupported p type\", e);\n    });\n  },\n        g = (t, r) => {\n    const i = e[r];\n    if (!o(i) || u.get(i) !== t) if (t instanceof n.Array) {\n      const n = s([]);\n      u.set(n, t), p(n, t, y), e[r] = n;\n    } else if (t instanceof n.Map) {\n      const n = s(t.toJSON());\n      u.set(n, t), f(n, t, y), e[r] = n;\n    } else a(t) ? e[r] = t : \"production\" !== process.env.NODE_ENV && console.warn(\"unsupported y type\", t);\n  };\n\n  Object.entries(e).forEach(_ref => {\n    let [e, t] = _ref;\n    const s = l.get(e);\n    i(t) && s instanceof n.Array && r(t, s.toJSON()) ? (u.set(t, s), p(t, s, y)) : !Array.isArray(t) && o(t) && s instanceof n.Map && r(t, s.toJSON()) ? (u.set(t, s), f(t, s, y)) : d(t, e);\n  }), l.forEach((t, s) => {\n    const a = e[s];\n    i(a) && t instanceof n.Array && r(a, t.toJSON()) ? (u.set(a, t), p(a, t, y)) : !Array.isArray(a) && o(a) && t instanceof n.Map && r(a, t.toJSON()) ? (u.set(a, t), f(a, t, y)) : g(t, s);\n  }), t(e, t => {\n    t.forEach(t => {\n      const s = t[1];\n      if (1 !== s.length) return;\n      const o = s[0];\n      if (\"delete\" === t[0]) l.delete(o);else if (\"set\" === t[0]) {\n        const t = e[o],\n              s = l.get(o);\n        r(s instanceof n.AbstractType ? s.toJSON() : s, t) || d(t, o);\n      }\n    });\n  }), l.observe(t => {\n    t.keysChanged.forEach(t => {\n      const s = l.get(t);\n      void 0 === s ? delete e[t] : g(s, t);\n    });\n  });\n},\n      p = function (e, a) {\n  let y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  const u = new WeakMap(),\n        d = (e, t) => {\n    if (i(e)) {\n      const s = new n.Array();\n      u.set(e, s), p(e, s, y), a.insert(t, [s]);\n    } else if (o(e)) {\n      const s = new n.Map();\n      u.set(e, s), f(e, s, y), a.insert(t, [s]);\n    } else {\n      if (!l(e)) throw new Error(\"unsupported p type\");\n      a.insert(t, [e]);\n    }\n  },\n        g = (t, r) => {\n    if (t instanceof n.Array) {\n      const n = s([]);\n      u.set(n, t), p(n, t, y), e.splice(r, 0, n);\n    } else if (t instanceof n.Map) {\n      const n = s(t.toJSON());\n      u.set(n, t), f(n, t), e.splice(r, 0, n);\n    } else {\n      if (!l(t)) throw new Error(\"unsupported y type\");\n      e.splice(r, 0, t);\n    }\n  };\n\n  e.forEach((e, t) => {\n    const s = a.get(t);\n    i(e) && s instanceof n.Array && r(e, s.toJSON()) ? u.get(e) !== s && (u.set(e, s), p(e, s, y)) : !Array.isArray(e) && o(e) && s instanceof n.Map && r(e, s.toJSON()) ? u.get(e) !== s && (u.set(e, s), f(e, s, y)) : l(e) && l(s) && e === s || d(e, t);\n  }), a.forEach((t, s) => {\n    const a = e[s];\n    i(a) && t instanceof n.Array && r(a, t.toJSON()) ? u.get(a) !== t && (u.set(a, t), p(a, t, y)) : !Array.isArray(a) && o(a) && t instanceof n.Map && r(a, t.toJSON()) ? u.get(a) !== t && (u.set(a, t), f(a, t, y)) : l(a) && l(t) && a === t || g(t, s);\n  }), e.splice(a.length), t(e, t => {\n    const s = (e => {\n      const t = e.flatMap(e => {\n        if (\"resolve\" === e[0] || \"reject\" === e[0]) return [];\n        if (1 !== e[1].length) return [];\n        const t = Number(e[1][0]);\n        return Number.isFinite(t) ? [[e[0], t, e[2], e[3]]] : [];\n      }),\n            s = (e, s) => {\n        let n = 0,\n            r = null;\n\n        for (; e + n + 1 < t.length;) {\n          if ((\"set\" === t[e + n + 1][0] || \"insert\" === t[e + n + 1][0]) && t[e + n + 1][1] < s && t[e + n + 1][3] === t[e][2]) return n + 1;\n          if (null !== r || \"set\" !== t[e + n + 1][0] && \"insert\" !== t[e + n + 1][0] || t[e + n + 1][1] !== s - (n + 1) || void 0 !== t[e + n + 1][3]) {\n            if (null === r && e + n + 1 < t.length && \"set\" === t[e + n + 1][0] && void 0 !== t[e + n + 1][3]) r = [e + n + 1, t[e + n + 1][1]], n += 1;else {\n              if (null === r || \"set\" !== t[e + n + 1][0] || t[e + n + 1][1] !== r[1] + (n + 1 - r[0]) || void 0 === t[e + n + 1][3]) return null;\n              n += 1;\n            }\n          } else n += 1;\n        }\n\n        return null;\n      },\n            n = (e, s) => {\n        let n = 0;\n\n        for (; e + n + 1 < t.length && \"delete\" === t[e + n + 1][0] && t[e + n + 1][1] === s - (n + 1);) n += 1;\n\n        return n;\n      };\n\n      let r = 0;\n\n      for (; r < t.length;) if (\"set\" !== t[r][0] && \"insert\" !== t[r][0] || void 0 !== t[r][3]) {\n        if (r > 0 && \"delete\" === t[r][0]) {\n          const e = t[r][1],\n                s = n(r, e);\n\n          if (\"set\" === t[r - 1][0] && t[r - 1][1] === e - (s + 1) && t[r - 1][2] === t[r][2]) {\n            const n = [\"delete\", e - (s + 1), t[r - 1][3], void 0];\n            t.splice(r - 1, 2), t.splice(r - 1 + s, 0, n), r -= 1;\n          } else r += 1;\n        } else r += 1;\n      } else {\n        const e = s(r, t[r][1]);\n        null !== e ? (t.splice(r + e, 1, [\"insert\", t[r + e][1], t[r + e][2], void 0]), t.splice(r, 1)) : r += 1;\n      }\n\n      return t;\n    })(t);\n\n    r(a.toJSON(), e) || c(a.doc, y, () => {\n      s.forEach(t => {\n        const s = t[1];\n        if (\"delete\" === t[0]) return void (a.length > s && a.delete(s, 1));\n        const n = e[s];\n        void 0 !== n && (\"set\" === t[0] ? (a.length > s && a.delete(s, 1), d(n, s)) : \"insert\" === t[0] && d(n, s));\n      });\n    });\n  }), a.observe(t => {\n    if (r(e, a.toJSON())) return;\n    let s = 0;\n    t.changes.delta.forEach(t => {\n      t.retain && (s += t.retain), t.delete && e.splice(s, t.delete), t.insert && (Array.isArray(t.insert) ? t.insert.forEach((e, t) => {\n        g(e, s + t);\n      }) : g(t.insert, s), s += t.insert.length);\n    });\n  });\n};\n\nexport { p as bindProxyAndYArray, f as bindProxyAndYMap };","map":{"version":3,"mappings":"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","names":["isProxyObject","x","undefined","getVersion","isProxyArray","Array","isArray","isPrimitiveMapValue","v","isPrimitiveArrayValue","transact","doc","opts","fn","transactionOrigin","bindProxyAndYMap","p","y","pv2yvCache","WeakMap","setPValueToY","pv","k","has","get","yv","Y","set","bindProxyAndYArray","Map","process","env","NODE_ENV","console","warn","setYValueToP","prev","proxy","toJSON","Object","entries","forEach","deepEqual","subscribe","ops","op","path","length","delete","AbstractType","observe","event","keysChanged","insertPValueToY","i","insert","Error","insertYValueToP","splice","arrayOps","flatMap","index","Number","isFinite","findCorrespondingInsert","startOpIndex","startArrayIndex","s","noInsert","findContinuousDelete","d","newArrayOp","retain","changes","delta","item"],"sources":["/Users/kuldeepupreti/Downloads/Projects/personal/yjs/node_modules/valtio-yjs/src/index.ts","/Users/kuldeepupreti/Downloads/Projects/personal/yjs/node_modules/valtio-yjs/src/parseProxyOps.ts"],"sourcesContent":["import { proxy, subscribe, getVersion } from 'valtio/vanilla';\nimport * as Y from 'yjs';\nimport deepEqual from 'fast-deep-equal';\nimport { parseProxyOps } from './parseProxyOps';\n\nconst isProxyObject = <T>(x: T): x is T & Record<string, unknown> =>\n  typeof x === 'object' && x !== null && getVersion(x) !== undefined;\n\nconst isProxyArray = <T>(x: T): x is T & unknown[] =>\n  Array.isArray(x) && getVersion(x) !== undefined;\n\nconst isPrimitiveMapValue = (v: unknown) =>\n  v === null ||\n  typeof v === 'string' ||\n  typeof v === 'number' ||\n  typeof v === 'boolean';\n\nconst isPrimitiveArrayValue = (v: unknown) =>\n  typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean';\n\ntype Options = {\n  transactionOrigin?: any;\n};\n\nconst transact = (doc: Y.Doc | null, opts: Options, fn: () => void) => {\n  if (doc) {\n    doc.transact(fn, opts.transactionOrigin);\n  } else {\n    fn();\n  }\n};\n\nexport const bindProxyAndYMap = <T>(\n  p: Record<string, T>,\n  y: Y.Map<T>,\n  opts: Options = {},\n) => {\n  const pv2yvCache = new WeakMap<object, unknown>();\n\n  const setPValueToY = (pv: T, k: string) => {\n    transact(y.doc, opts, () => {\n      if (\n        isProxyObject(pv) &&\n        pv2yvCache.has(pv) &&\n        pv2yvCache.get(pv) === y.get(k)\n      ) {\n        return;\n      }\n      if (isProxyArray(pv)) {\n        const yv = new Y.Array();\n        pv2yvCache.set(pv, yv);\n        bindProxyAndYArray(pv, yv, opts);\n        y.set(k, yv as unknown as T);\n      } else if (isProxyObject(pv)) {\n        const yv = new Y.Map();\n        pv2yvCache.set(pv, yv);\n        bindProxyAndYMap(pv, yv, opts);\n        y.set(k, yv as unknown as T);\n      } else if (isPrimitiveMapValue(pv)) {\n        y.set(k, pv);\n      } else if (process.env.NODE_ENV !== 'production') {\n        console.warn('unsupported p type', pv);\n      }\n    });\n  };\n\n  const setYValueToP = (yv: T, k: string) => {\n    const prev = p[k];\n    if (isProxyObject(prev) && pv2yvCache.get(prev) === yv) {\n      return;\n    }\n    if (yv instanceof Y.Array) {\n      const pv = proxy([]);\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYArray(pv, yv, opts);\n      p[k] = pv as unknown as T;\n    } else if (yv instanceof Y.Map) {\n      const pv = proxy(yv.toJSON());\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYMap(pv, yv, opts);\n      p[k] = pv as unknown as T;\n    } else if (isPrimitiveMapValue(yv)) {\n      p[k] = yv;\n    } else if (process.env.NODE_ENV !== 'production') {\n      console.warn('unsupported y type', yv);\n    }\n  };\n\n  // initialize from p\n  Object.entries(p).forEach(([k, pv]) => {\n    const yv = y.get(k);\n    if (\n      isProxyArray(pv) &&\n      yv instanceof Y.Array &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYArray(pv, yv, opts);\n    } else if (\n      !Array.isArray(pv) &&\n      isProxyObject(pv) &&\n      yv instanceof Y.Map &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYMap(pv, yv, opts);\n    } else {\n      setPValueToY(pv, k);\n    }\n  });\n\n  // initialize from y\n  y.forEach((yv, k) => {\n    const pv = p[k];\n    if (\n      isProxyArray(pv) &&\n      yv instanceof Y.Array &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYArray(pv, yv, opts);\n    } else if (\n      !Array.isArray(pv) &&\n      isProxyObject(pv) &&\n      yv instanceof Y.Map &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYMap(pv, yv, opts);\n    } else {\n      setYValueToP(yv, k);\n    }\n  });\n\n  // subscribe p\n  subscribe(p, (ops) => {\n    ops.forEach((op) => {\n      const path = op[1];\n      if (path.length !== 1) {\n        return;\n      }\n      const k = path[0] as string;\n      if (op[0] === 'delete') {\n        y.delete(k);\n      } else if (op[0] === 'set') {\n        const pv = p[k];\n        const yv = y.get(k);\n        if (!deepEqual(yv instanceof Y.AbstractType ? yv.toJSON() : yv, pv)) {\n          setPValueToY(pv, k);\n        }\n      }\n    });\n  });\n\n  // subscribe y\n  y.observe((event) => {\n    event.keysChanged.forEach((k) => {\n      const yv = y.get(k);\n      if (yv === undefined) {\n        delete p[k];\n      } else {\n        setYValueToP(yv, k);\n      }\n    });\n  });\n};\n\nexport const bindProxyAndYArray = <T>(\n  p: T[],\n  y: Y.Array<T>,\n  opts: Options = {},\n) => {\n  const pv2yvCache = new WeakMap<object, unknown>();\n\n  const insertPValueToY = (pv: T, i: number) => {\n    if (isProxyArray(pv)) {\n      const yv = new Y.Array();\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYArray(pv, yv, opts);\n      y.insert(i, [yv as unknown as T]);\n    } else if (isProxyObject(pv)) {\n      const yv = new Y.Map();\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYMap(pv, yv, opts);\n      y.insert(i, [yv as unknown as T]);\n    } else if (isPrimitiveArrayValue(pv)) {\n      y.insert(i, [pv]);\n    } else {\n      throw new Error('unsupported p type');\n    }\n  };\n\n  const insertYValueToP = (yv: T, i: number) => {\n    if (yv instanceof Y.Array) {\n      const pv = proxy([]);\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYArray(pv, yv, opts);\n      p.splice(i, 0, pv as unknown as T);\n    } else if (yv instanceof Y.Map) {\n      const pv = proxy(yv.toJSON());\n      pv2yvCache.set(pv, yv);\n      bindProxyAndYMap(pv, yv);\n      p.splice(i, 0, pv as unknown as T);\n    } else if (isPrimitiveArrayValue(yv)) {\n      p.splice(i, 0, yv);\n    } else {\n      throw new Error('unsupported y type');\n    }\n  };\n\n  // initialize from p\n  p.forEach((pv, i) => {\n    const yv = y.get(i);\n    if (\n      isProxyArray(pv) &&\n      yv instanceof Y.Array &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      if (pv2yvCache.get(pv) !== yv) {\n        pv2yvCache.set(pv, yv);\n        bindProxyAndYArray(pv, yv, opts);\n      }\n    } else if (\n      !Array.isArray(pv) &&\n      isProxyObject(pv) &&\n      yv instanceof Y.Map &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      if (pv2yvCache.get(pv) !== yv) {\n        pv2yvCache.set(pv, yv);\n        bindProxyAndYMap(pv, yv, opts);\n      }\n    } else if (\n      isPrimitiveArrayValue(pv) &&\n      isPrimitiveArrayValue(yv) &&\n      pv === yv\n    ) {\n      // do nothing\n    } else {\n      insertPValueToY(pv, i);\n    }\n  });\n\n  // initialize from y\n  y.forEach((yv, i) => {\n    const pv = p[i];\n    if (\n      isProxyArray(pv) &&\n      yv instanceof Y.Array &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      if (pv2yvCache.get(pv) !== yv) {\n        pv2yvCache.set(pv, yv);\n        bindProxyAndYArray(pv, yv, opts);\n      }\n    } else if (\n      !Array.isArray(pv) &&\n      isProxyObject(pv) &&\n      yv instanceof Y.Map &&\n      deepEqual(pv, yv.toJSON())\n    ) {\n      if (pv2yvCache.get(pv) !== yv) {\n        pv2yvCache.set(pv, yv);\n        bindProxyAndYMap(pv, yv, opts);\n      }\n    } else if (\n      isPrimitiveArrayValue(pv) &&\n      isPrimitiveArrayValue(yv) &&\n      pv === yv\n    ) {\n      // do nothing\n    } else {\n      insertYValueToP(yv, i);\n    }\n  });\n\n  // strip p\n  p.splice(y.length);\n\n  // subscribe p\n  subscribe(p, (ops) => {\n    const arrayOps = parseProxyOps(ops);\n    if (deepEqual(y.toJSON(), p)) {\n      return;\n    }\n    transact(y.doc, opts, () => {\n      arrayOps.forEach((op) => {\n        const i = op[1];\n        if (op[0] === 'delete') {\n          if (y.length > i) {\n            y.delete(i, 1);\n          }\n          return;\n        }\n        const pv = p[i];\n        if (pv === undefined) {\n          return;\n        }\n        if (op[0] === 'set') {\n          if (y.length > i) {\n            y.delete(i, 1);\n          }\n          insertPValueToY(pv, i);\n        } else if (op[0] === 'insert') {\n          insertPValueToY(pv, i);\n        }\n      });\n    });\n  });\n\n  // subscribe y\n  y.observe((event) => {\n    if (deepEqual(p, y.toJSON())) {\n      return;\n    }\n    let retain = 0;\n    event.changes.delta.forEach((item) => {\n      if (item.retain) {\n        retain += item.retain;\n      }\n      if (item.delete) {\n        p.splice(retain, item.delete);\n      }\n      if (item.insert) {\n        if (Array.isArray(item.insert)) {\n          item.insert.forEach((yv, i) => {\n            insertYValueToP(yv, retain + i);\n          });\n        } else {\n          insertYValueToP(item.insert as unknown as T, retain);\n        }\n        retain += item.insert.length;\n      }\n    });\n  });\n};\n","import { subscribe } from 'valtio/vanilla';\n\ntype Op = Parameters<Parameters<typeof subscribe>[1]>[0][number];\ntype ArrayOp = [\n  op: 'insert' | 'set' | 'delete',\n  index: number,\n  value1: unknown,\n  value2: unknown,\n];\n\nexport const parseProxyOps = (ops: Op[]): ArrayOp[] => {\n  const arrayOps: ArrayOp[] = ops.flatMap((op) => {\n    if (op[0] === 'resolve' || op[0] === 'reject') return [];\n    if (op[1].length !== 1) return [];\n    const index = Number(op[1][0]);\n    if (!Number.isFinite(index)) return [];\n    return [[op[0], index, op[2], op[3]]];\n  });\n\n  const findCorrespondingInsert = (\n    startOpIndex: number,\n    startArrayIndex: number,\n  ) => {\n    let s = 0;\n    let noInsert: [startOpIndex: number, startArrayIndex: number] | null = null;\n    while (startOpIndex + s + 1 < arrayOps.length) {\n      if (\n        (arrayOps[startOpIndex + s + 1][0] === 'set' ||\n          arrayOps[startOpIndex + s + 1][0] === 'insert') &&\n        arrayOps[startOpIndex + s + 1][1] < startArrayIndex &&\n        arrayOps[startOpIndex + s + 1][3] === arrayOps[startOpIndex][2]\n      ) {\n        return s + 1;\n      }\n      if (\n        noInsert === null &&\n        (arrayOps[startOpIndex + s + 1][0] === 'set' ||\n          arrayOps[startOpIndex + s + 1][0] === 'insert') &&\n        arrayOps[startOpIndex + s + 1][1] === startArrayIndex - (s + 1) &&\n        arrayOps[startOpIndex + s + 1][3] === undefined\n      ) {\n        s += 1;\n      } else if (\n        noInsert === null &&\n        startOpIndex + s + 1 < arrayOps.length &&\n        arrayOps[startOpIndex + s + 1][0] === 'set' &&\n        arrayOps[startOpIndex + s + 1][3] !== undefined\n      ) {\n        noInsert = [startOpIndex + s + 1, arrayOps[startOpIndex + s + 1][1]];\n        s += 1;\n      } else if (\n        noInsert !== null &&\n        arrayOps[startOpIndex + s + 1][0] === 'set' &&\n        arrayOps[startOpIndex + s + 1][1] ===\n          noInsert[1] + (s + 1 - noInsert[0]) &&\n        arrayOps[startOpIndex + s + 1][3] !== undefined\n      ) {\n        s += 1;\n      } else {\n        return null;\n      }\n    }\n    return null;\n  };\n\n  const findContinuousDelete = (\n    startOpIndex: number,\n    startArrayIndex: number,\n  ) => {\n    let d = 0;\n    while (\n      startOpIndex + d + 1 < arrayOps.length &&\n      arrayOps[startOpIndex + d + 1][0] === 'delete' &&\n      arrayOps[startOpIndex + d + 1][1] === startArrayIndex - (d + 1)\n    ) {\n      d += 1;\n    }\n    return d;\n  };\n\n  let i = 0;\n  while (i < arrayOps.length) {\n    if (\n      (arrayOps[i][0] === 'set' || arrayOps[i][0] === 'insert') &&\n      arrayOps[i][3] === undefined\n    ) {\n      const startArrayIndex = arrayOps[i][1];\n      const s = findCorrespondingInsert(i, startArrayIndex);\n      if (s !== null) {\n        const newArrayOp: ArrayOp = [\n          'insert',\n          arrayOps[i + s][1],\n          arrayOps[i + s][2],\n          undefined,\n        ];\n        arrayOps.splice(i + s, 1, newArrayOp);\n        arrayOps.splice(i, 1);\n      } else {\n        i += 1;\n      }\n    } else if (i > 0 && arrayOps[i][0] === 'delete') {\n      const startArrayIndex = arrayOps[i][1];\n      const d = findContinuousDelete(i, startArrayIndex);\n      if (\n        arrayOps[i - 1][0] === 'set' &&\n        arrayOps[i - 1][1] === startArrayIndex - (d + 1) &&\n        arrayOps[i - 1][2] === arrayOps[i][2]\n      ) {\n        const newArrayOp: ArrayOp = [\n          'delete',\n          startArrayIndex - (d + 1),\n          arrayOps[i - 1][3],\n          undefined,\n        ];\n        arrayOps.splice(i - 1, 2);\n        arrayOps.splice(i - 1 + d, 0, newArrayOp);\n        i -= 1;\n      } else {\n        i += 1;\n      }\n    } else {\n      i += 1;\n    }\n  }\n\n  return arrayOps;\n};\n"]},"metadata":{},"sourceType":"module"}